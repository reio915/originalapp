<h1>ユーザー検索</h1>

<%= form_with url: search_users_path, method: :get, local: true do |f| %>
  <%= f.text_field :q, placeholder: "ユーザー名で検索" %>
  <%= f.submit "検索" %>
<% end %>

<% if @users.present? %>
  <ul class="users">
    <% @users.each do |user| %>
      <li>
        <%= link_to user.name, user %>
        <% if current_user != user %>
          <% if current_user.following?(user) %>
            <%= form_with model: current_user.active_relationships.find_by(followed_id: user.id), method: :delete, local: true do |f| %>
              <%= f.submit "フォロー解除" %>
            <% end %>
          <% else %>
            <%= form_with model: current_user.active_relationships.build, local: true do |f| %>
              <%= hidden_field_tag :followed_id, user.id %>
              <%= f.submit "フォロー" %>
            <% end %>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
  <%= will_paginate @users %>
<% else %>
  <p>該当するユーザーは見つかりませんでした。</p>
<% end %>